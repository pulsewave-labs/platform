[build]
builder = "NIXPACKS"
buildCommand = "cd api && npm install && npm run build"

[deploy]
startCommand = "cd api && npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[environments.production]
variables = {}

[environments.staging]
variables = {}

[[services]]
name = "pulsewave-api"
source = "api/"

[services.healthcheck]
path = "/health"
port = 3001

[services.networking]
serviceDomain = "pulsewave-api"

[[services.volumes]]
name = "uploads"
mountPath = "/tmp/uploads"